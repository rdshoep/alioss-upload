!function(t){function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var e={};n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="/dist/",n(n.s=22)}([function(t,n,e){"use strict";function o(){}function r(t){try{return t.then}catch(t){return g=t,m}}function i(t,n){try{return t(n)}catch(t){return g=t,m}}function u(t,n,e){try{t(n,e)}catch(t){return g=t,m}}function c(t){if("object"!==v(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("Promise constructor's argument is not a function");this._99=0,this._44=0,this._7=null,this._12=null,t!==o&&d(t,this)}function f(t,n,e){return new t.constructor(function(r,i){var u=new c(o);u.then(r,i),s(t,new y(n,e,u))})}function s(t,n){for(;3===t._44;)t=t._7;if(c._32&&c._32(t),0===t._44)return 0===t._99?(t._99=1,void(t._12=n)):1===t._99?(t._99=2,void(t._12=[t._12,n])):void t._12.push(n);a(t,n)}function a(t,n){b(function(){var e=1===t._44?n.onFulfilled:n.onRejected;if(null===e)return void(1===t._44?l(n.promise,t._7):p(n.promise,t._7));var o=i(e,t._7);o===m?p(n.promise,g):l(n.promise,o)})}function l(t,n){if(n===t)return p(t,new TypeError("A promise cannot be resolved with itself."));if(n&&("object"===(void 0===n?"undefined":v(n))||"function"==typeof n)){var e=r(n);if(e===m)return p(t,g);if(e===t.then&&n instanceof c)return t._44=3,t._7=n,void h(t);if("function"==typeof e)return void d(e.bind(n),t)}t._44=1,t._7=n,h(t)}function p(t,n){t._44=2,t._7=n,c._89&&c._89(t,n),h(t)}function h(t){if(1===t._99&&(s(t,t._12),t._12=null),2===t._99){for(var n=0;n<t._12.length;n++)s(t,t._12[n]);t._12=null}}function y(t,n,e){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof n?n:null,this.promise=e}function d(t,n){var e=!1,o=u(t,function(t){e||(e=!0,l(n,t))},function(t){e||(e=!0,p(n,t))});e||o!==m||(e=!0,p(n,g))}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b=e(4),g=null,m={};t.exports=c,c._32=null,c._89=null,c._27=o,c.prototype.then=function(t,n){if(this.constructor!==c)return f(this,t,n);var e=new c(o);return s(this,new y(t,n,e)),e}},function(t,n,e){"use strict";t.exports=e(3)},function(t,n,e){"use strict";function o(){if(arguments&&arguments.length>1){for(var t=arguments[0]||{},n=1;n<arguments.length;n++){var e=arguments[n];if(e)for(var o in e)t.hasOwnProperty(o)&&t[o]===e[o]||(t[o]=e[o])}return t}return arguments[0]}function r(t,n,e){t=String(t);var o=-1;for(e||0===e||(e=" "),n-=t.length;++o<n;)t=e+t;return t}function i(t,n){return t&&"function"==typeof t?function(){t.apply(this,[null].concat([].slice.apply(arguments))),n.apply(this,arguments)}:n}function u(t,n){return t&&"function"==typeof t?function(){t.apply(this,arguments),n.apply(this,arguments)}:n}function c(t){return t&&t instanceof Function?t:f}function f(){}Object.defineProperty(n,"__esModule",{value:!0}),n.extend=o,n.leftpad=r,n.concatResolve=i,n.concatReject=u,n.resolveFunctoin=c,n.noop=f},function(t,n,e){"use strict";t.exports=e(7)},function(t,n,e){"use strict";(function(n){function e(t){u.length||(i(),c=!0),u[u.length]=t}function o(){for(;f<u.length;){var t=f;if(f+=1,u[t].call(),f>s){for(var n=0,e=u.length-f;n<e;n++)u[n]=u[n+f];u.length-=f,f=0}}u.length=0,f=0,c=!1}function r(t){return function(){function n(){clearTimeout(e),clearInterval(o),t()}var e=setTimeout(n,0),o=setInterval(n,50)}}t.exports=e;var i,u=[],c=!1,f=0,s=1024,a=void 0!==n?n:self,l=a.MutationObserver||a.WebKitMutationObserver;i="function"==typeof l?function(t){var n=1,e=new l(t),o=document.createTextNode("");return e.observe(o,{characterData:!0}),function(){n=-n,o.data=n}}(o):r(o),e.requestFlush=i,e.makeRequestCallFromTimer=r}).call(n,e(8))},function(t,n,e){"use strict";var o,r;"function"==typeof Symbol&&Symbol.iterator;!function(i,u){o=u,void 0!==(r="function"==typeof o?o.call(n,e,n,t):o)&&(t.exports=r)}(0,function(){function t(t){var o=["get","post","put","delete"];return t=t||{},t.baseUrl=t.baseUrl||"",t.method&&t.url?e(t.method,t.baseUrl+t.url,n(t.data),t):o.reduce(function(o,r){return o[r]=function(o,i){return e(r,t.baseUrl+o,n(i),t)},o},{})}function n(t){return t||null}function e(t,n,e,r){var u=["then","catch","always"],f=u.reduce(function(t,n){return t[n]=function(e){return t[n]=e,t},t},{}),s=new XMLHttpRequest;return s.open(t,n,!0),s.withCredentials=r.hasOwnProperty("withCredentials"),o(s,r.headers),s.addEventListener("readystatechange",i(f,s),!1),s.send(c(e)),f.abort=function(){return s.abort()},f}function o(t,n){n=n||{},r(n)||(n["Content-Type"]="application/x-www-form-urlencoded"),Object.keys(n).forEach(function(e){n[e]&&t.setRequestHeader(e,n[e])})}function r(t){return Object.keys(t).some(function(t){return"content-type"===t.toLowerCase()})}function i(t,n){return function e(){n.readyState===n.DONE&&(n.removeEventListener("readystatechange",e,!1),t.always.apply(t,u(n)),n.status>=200&&n.status<300?t.then.apply(t,u(n)):t.catch.apply(t,u(n)))}}function u(t){var n;try{n=JSON.parse(t.responseText)}catch(e){n=t.responseText}return[n,t]}function c(t){return f(t)?s(t):t}function f(t){return"[object Object]"===Object.prototype.toString.call(t)}function s(t){return Object.keys(t).reduce(function(n,e){return(n?n+"&":"")+a(e)+"="+a(t[e])},"")}function a(t){return encodeURIComponent(t)}return t})},function(t,n,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t){return t.getFullYear()+"/"+(0,s.leftpad)(t.getMonth()+1,2,"0")+"/"+(0,s.leftpad)(t.getDate(),2,"0")+"/"+(0,s.leftpad)(t.getHours(),2,"0")}function u(t){t=t||{};var n=new Date,e=t.prefix||i(n),o=t.suffix||"",r=(0,s.leftpad)(Math.round(99999*Math.random()),5,0);return e+n.getTime()+"_"+r+o}Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),s=e(2),a=e(1),l=o(a),p=e(15),h=o(p),y=e(16),d=o(y),v="alioss",b=function(){function t(n,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;r(this,t),this.client=n,this.options=e||{},this.engine=o,this.token=new h.default(this.options.token||this.options.auth)}return f(t,[{key:"verify",value:function(){var t=this;return l.default.resolve(t.token).then(function(n){return n.isValid()?n:n.authorize({"x-upload-client":t.client.name(),"x-upload-engine":t.engine}).then(function(n){t.client.init(Object.assign(t.options,{token:n}))})})}},{key:"upload",value:function(t,n,e){var o=this;return this.verify().then(function(){return o._upload(t,n,e)}).catch(function(t){return console.log(t)})}},{key:"_upload",value:function(t,n,e){n&&"object"==(void 0===n?"undefined":c(n))&&(e=e||n,n=void 0);var o=e||{};if(n&&"string"==typeof n)n=n.toString();else if(n&&n instanceof Function)n=n();else if(t instanceof File&&!o.suffix){var r=t.name;o.suffix=r.substr(r.lastIndexOf(".")),n=u(e)}else n=u(e);var i=(0,s.resolveFunctoin)(o.error);if(!t){var f="file content can not be empty!";return i(n,f),l.default.reject(f)}return o.token=this.token.token,new d.default(this,this.client,t,Object.assign(o,{name:n})).start()}}]),t}();n.default=b},function(t,n,e){"use strict";t.exports=e(0),e(9),e(10),e(11),e(12),e(14)},function(t,n,e){"use strict";var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(o=window)}t.exports=o},function(t,n,e){"use strict";var o=e(0);t.exports=o,o.prototype.done=function(t,n){(arguments.length?this.then.apply(this,arguments):this).then(null,function(t){setTimeout(function(){throw t},0)})}},function(t,n,e){"use strict";var o=e(0);t.exports=o,o.prototype.finally=function(t){return this.then(function(n){return o.resolve(t()).then(function(){return n})},function(n){return o.resolve(t()).then(function(){throw n})})}},function(t,n,e){"use strict";function o(t){var n=new i(i._27);return n._44=1,n._7=t,n}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=e(0);t.exports=i;var u=o(!0),c=o(!1),f=o(null),s=o(void 0),a=o(0),l=o("");i.resolve=function(t){if(t instanceof i)return t;if(null===t)return f;if(void 0===t)return s;if(!0===t)return u;if(!1===t)return c;if(0===t)return a;if(""===t)return l;if("object"===(void 0===t?"undefined":r(t))||"function"==typeof t)try{var n=t.then;if("function"==typeof n)return new i(n.bind(t))}catch(t){return new i(function(n,e){e(t)})}return o(t)},i.all=function(t){var n=Array.prototype.slice.call(t);return new i(function(t,e){function o(c,f){if(f&&("object"===(void 0===f?"undefined":r(f))||"function"==typeof f)){if(f instanceof i&&f.then===i.prototype.then){for(;3===f._44;)f=f._7;return 1===f._44?o(c,f._7):(2===f._44&&e(f._7),void f.then(function(t){o(c,t)},e))}var s=f.then;if("function"==typeof s){return void new i(s.bind(f)).then(function(t){o(c,t)},e)}}n[c]=f,0==--u&&t(n)}if(0===n.length)return t([]);for(var u=n.length,c=0;c<n.length;c++)o(c,n[c])})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(t){return new i(function(n,e){t.forEach(function(t){i.resolve(t).then(n,e)})})},i.prototype.catch=function(t){return this.then(null,t)}},function(t,n,e){"use strict";function o(t,n){for(var e=[],o=0;o<n;o++)e.push("a"+o);var r=["return function ("+e.join(",")+") {","var self = this;","return new Promise(function (rs, rj) {","var res = fn.call(",["self"].concat(e).concat([c]).join(","),");","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],r)(i,t)}function r(t){for(var n=Math.max(t.length-1,3),e=[],o=0;o<n;o++)e.push("a"+o);var r=["return function ("+e.join(",")+") {","var self = this;","var args;","var argLength = arguments.length;","if (arguments.length > "+n+") {","args = new Array(arguments.length + 1);","for (var i = 0; i < arguments.length; i++) {","args[i] = arguments[i];","}","}","return new Promise(function (rs, rj) {","var cb = "+c+";","var res;","switch (argLength) {",e.concat(["extra"]).map(function(t,n){return"case "+n+":res = fn.call("+["self"].concat(e.slice(0,n)).concat("cb").join(",")+");break;"}).join(""),"default:","args[argLength] = cb;","res = fn.apply(self, args);","}","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],r)(i,t)}var i=e(0),u=e(13);t.exports=i,i.denodeify=function(t,n){return"number"==typeof n&&n!==1/0?o(t,n):r(t)};var c="function (err, res) {if (err) { rj(err); } else { rs(res); }}";i.nodeify=function(t){return function(){var n=Array.prototype.slice.call(arguments),e="function"==typeof n[n.length-1]?n.pop():null,o=this;try{return t.apply(this,arguments).nodeify(e,o)}catch(t){if(null===e||void 0===e)return new i(function(n,e){e(t)});u(function(){e.call(o,t)})}}},i.prototype.nodeify=function(t,n){if("function"!=typeof t)return this;this.then(function(e){u(function(){t.call(n,null,e)})},function(e){u(function(){t.call(n,e)})})}},function(t,n,e){"use strict";function o(){if(f.length)throw f.shift()}function r(t){var n;n=c.length?c.pop():new i,n.task=t,u(n)}function i(){this.task=null}var u=e(4),c=[],f=[],s=u.makeRequestCallFromTimer(o);t.exports=r,i.prototype.call=function(){try{this.task.call()}catch(t){r.onerror?r.onerror(t):(f.push(t),s())}finally{this.task=null,c[c.length]=this}}},function(t,n,e){"use strict";var o=e(0);t.exports=o,o.enableSynchronous=function(){o.prototype.isPending=function(){return 0==this.getState()},o.prototype.isFulfilled=function(){return 1==this.getState()},o.prototype.isRejected=function(){return 2==this.getState()},o.prototype.getValue=function(){if(3===this._44)return this._7.getValue();if(!this.isFulfilled())throw new Error("Cannot get a value of an unfulfilled promise.");return this._7},o.prototype.getReason=function(){if(3===this._44)return this._7.getReason();if(!this.isRejected())throw new Error("Cannot get a rejection reason of a non-rejected promise.");return this._7},o.prototype.getState=function(){return 3===this._44?this._7.getState():-1===this._44||-2===this._44?0:this._44}},o.disableSynchronous=function(){o.prototype.isPending=void 0,o.prototype.isFulfilled=void 0,o.prototype.isRejected=void 0,o.prototype.getValue=void 0,o.prototype.getReason=void 0,o.prototype.getState=void 0}},function(t,n,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t){var n=t.Expiration||t.expiration;if(!n){var e=t.expiresIn||t.expires_in;e&&(n=Date.now()+Number(e))}return n=n||Date.now()+864e5,new Date(n).getTime()}function u(t,n,e){e=(0,l.resolveFunctoin)(e),(0,a.default)({headers:n}).get(t).then(function(t,n){t&&"object"==(void 0===t?"undefined":f(t))?e(void 0,t):e("request to sts server error: ("+n.status+")"+n.responseText)}).catch(function(t,n){e("request to sts server error: ("+n.status+")"+n.responseText)})}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=e(5),a=o(s),l=e(2),p=e(1),h=o(p),y=function(){function t(n){if(r(this,t),"string"==typeof n)this.authUrl=n;else{if("object"!==(void 0===n?"undefined":f(n)))throw new Error("invalid token setting(Accepts: string/object)");this.token=n,this.expiration=i(this.token)}}return c(t,[{key:"isValid",value:function(){return Date.now()<this.expiration}},{key:"authorize",value:function(t){var n=this;return new h.default(function(e,o){u(n.authUrl,t,function(t,n){t?o(t):e(n)})}).then(function(t){return n.token=t,n.expiration=i(t),t})}}]),t}();n.default=y},function(t,n,e){"use strict";function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),i=e(1),u=function(t){return t&&t.__esModule?t:{default:t}}(i),c=function(){function t(n,e,r,i){o(this,t),this.uploader=n,this.client=e,this.data=r,this.option=i}return r(t,[{key:"start",value:function(){var t=this;return(this.uploader.options.middlewares||[]).reduce(function(n,e){return n.then(function(){return e(t)})},u.default.resolve(this)).then(function(){return t.upload()})}},{key:"upload",value:function(){var t=this.option.name;return this.client.upload(this.data,t,this.option)}}]),t}();n.default=c},function(t,n,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){var e=void 0;return n&&(n.style&&"string"==typeof n.style&&(e="@!"+n.style),n.config&&"string"==typeof n.config&&(e="@"+n.config)),t&&e?t+e:t}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),c=e(2),f=e(5),s=(o(f),e(1)),a=o(s),l=function(){function t(n){r(this,t),this.options=n||{}}return u(t,[{key:"name",value:function(){return"alioss"}},{key:"init",value:function(t){var n=(0,c.extend)({},this.options,t),e=n.token,o=void 0;e&&(o={region:e.region,accessKeyId:e.AccessKeyId,accessKeySecret:e.AccessKeySecret,stsToken:e.SecurityToken,bucket:e.bucket,static:e.static}),this._initClient((0,c.extend)({},n,o))}},{key:"_initClient",value:function(t){this.options=(0,c.extend)({},this.options,t),this.client=new OSS.Wrapper({region:t.region,accessKeyId:t.accessKeyId,accessKeySecret:t.accessKeySecret,stsToken:t.stsToken,bucket:t.bucket}),t.static?this.domain=t.static:this.domain="http://"+t.bucket+"."+t.region+".aliyuncs.com/"}},{key:"verify",value:function(){return a.default.resolve(this).then(function(t){if(!t.options.token)return a.default.reject("AliossFileUpload Client without token node, you need use init method to config.")})}},{key:"_uploadImpl",value:function(t,n,e,o){return e=e||"file","file"==e?(console.log(n,t,o),this.client.multipartUpload(n,t,o)):"buffer"==e?(console.log(n,t,o,OSS.Buffer),this.client.put(n,new OSS.Buffer(t))):a.default.reject("unsupported upload data type:"+e)}},{key:"upload",value:function(t,n,e){var o=e||{},r=(0,c.resolveFunctoin)(o.before),u=(0,c.resolveFunctoin)(o.success),f=(0,c.resolveFunctoin)(o.error),s=(0,c.resolveFunctoin)(o.progress),l=this,p=o.type||"file";return t?this.verify().then(function(){return r(n),console.log("begin upload"),l._uploadImpl(t,n,p,{progress:function(t){return function(e){console.log("upload progress: %s",t),s(n,t),e()}}})}).then(function(t){return console.log("upload success: %j",t),t.url=i(l.domain+t.name,o),u(n,t),t}).catch(function(t){return console.log("upload error: %j",t),f(n,t),a.default.reject(t)}):new a.default(function(t,e){f(n,"file content can not be empty!"),e(err)})}}]),t}();n.default=l},,,,,function(t,n,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),u=e(6),c=o(u),f=e(17),s=o(f),a=function(){function t(n){r(this,t);var e=new s.default;this.fileUploader=new c.default(e,n)}return i(t,[{key:"upload",value:function(t,n,e){return this.fileUploader.upload(t,n,e)}}]),t}();window.Uploader=window.FileUpload=a}]);